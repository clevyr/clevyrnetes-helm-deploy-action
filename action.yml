name: "Clevyrnetes Helm Deploy Action"
description: "Updates a Clevyrnetes Helm Chart"
branding:
  icon: upload-cloud
  color: green
runs:
  using: composite
  steps:
    - name: Set up yq
      uses: frenck/action-setup-yq@v1
    - name: Set up SOPS
      uses: mdgreenwald/mozilla-sops-action@v1.4.1
    - name: GCloud auth
      uses: google-github-actions/auth@v1
      with:
        credentials_json: ${{ env.GCLOUD_KEY_FILE }}
    - name: GKE auth
      uses: google-github-actions/get-gke-credentials@v1
      with:
        cluster_name: ${{ env.GCLOUD_CLUSTER_NAME || 'clevyrnetes' }}
        project_id: ${{ env.HOST_PROJECT || 'momma-motus' }}
        location: us-central1
    - name: Main script
      shell: bash
      env:
        ACTION_PATH: ${{ github.action_path }}
      run: "$ACTION_PATH/main.sh"
